{"version":3,"sources":["webpack:///webpack/universalModuleDefinition?5ca6********","webpack:///(webpack)/buildin/global.js?3698*****","webpack:///./~/_in-viewport@3.6.0@in-viewport/in-viewport.js?a6e2","webpack:///./src/inViewPort/index.js","webpack:///./src/plugins/lazyLoad/index.js"],"names":["inViewport","require","LazyLoad","container","offset","src","actions","lazyLoad","refresh","supportsMutationObserver","global","MutationObserver","$pageContent","$","items","find","placeholderSrc","length","each","i","$img","$$img","attr","addClass","elt","realSrc","isLazyFlag","onerror","e","on","hasClass","removeClass","console","log","hooks","onPageDidAppear","pageId","$page","model"],"mappings":";;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD,O;;;;;ACVA;;AAEA;AACA;AACA;AACA,CAAC;;AAED;AACA;AACA;AACA,CAAC;AACD;AACA;AACA;AACA;;AAEA;AACA;AACA,4CAA4C;;AAE5C;;;;;;;;;;;;;;;;ACpBA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAG;AACH;AACA;;AAEA;AACA;AACA;AACA;;AAEA,iBAAiB,sBAAsB;AACvC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AA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","file":"lazyloadman.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"fastman\"] = factory();\n\telse\n\t\troot[\"fastman\"] = factory();\n})(this, function() {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition","var g;\r\n\r\n// This works in non-strict mode\r\ng = (function() {\r\n\treturn this;\r\n})();\r\n\r\ntry {\r\n\t// This works if eval is allowed (see CSP)\r\n\tg = g || Function(\"return this\")() || (1,eval)(\"this\");\r\n} catch(e) {\r\n\t// This works if the window reference is available\r\n\tif(typeof window === \"object\")\r\n\t\tg = window;\r\n}\r\n\r\n// g can still be undefined, but nothing to do about it...\r\n// We return undefined, instead of nothing here, so it's\r\n// easier to handle this case. if(!global) { ...}\r\n\r\nmodule.exports = g;\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// (webpack)/buildin/global.js\n// module id = 1\n// module chunks = 0 1 3 5 6 7 8 9","module.exports = inViewport;\n\nvar instances = [];\nvar supportsMutationObserver = typeof global.MutationObserver === 'function';\n\nfunction inViewport(elt, params, cb) {\n  var opts = {\n    container: global.document.body,\n    offset: 0,\n    debounce: 15,\n    failsafe: 150\n  };\n\n  if (params === undefined || typeof params === 'function') {\n    cb = params;\n    params = {};\n  }\n\n  var container = opts.container = params.container || opts.container;\n  var offset = opts.offset = params.offset || opts.offset;\n  var debounceValue = opts.debounce = params.debounce || opts.debounce;\n  var failsafe = opts.failsafe = params.failsafe || opts.failsafe;\n\n  // ensure backward compatibility with failsafe as boolean\n  if (failsafe === true) {\n    failsafe = 150;\n  } else if(failsafe === false) {\n    failsafe = 0;\n  }\n\n  // failsafe check always needs to be higher than debounceValue\n  if (failsafe > 0 && failsafe < debounceValue) {\n      failsafe = debounceValue + 50;\n  }\n\n  for (var i = 0; i < instances.length; i++) {\n    if (\n      instances[i].container === container &&\n      instances[i]._debounce === debounceValue &&\n      instances[i]._failsafe === failsafe\n    ) {\n      return instances[i].isInViewport(elt, offset, cb);\n    }\n  }\n\n  return instances[\n    instances.push(createInViewport(container, debounceValue, failsafe)) - 1\n  ].isInViewport(elt, offset, cb);\n}\n\nfunction addEvent(el, type, fn) {\n  if (el.attachEvent) {\n    el.attachEvent('on' + type, fn);\n  } else {\n    el.addEventListener(type, fn, false);\n  }\n}\n\nfunction debounce(func, wait, immediate) {\n  var timeout;\n  return function () {\n    var context = this, args = arguments;\n    var callNow = immediate && !timeout;\n    clearTimeout(timeout);\n    timeout = setTimeout(later, wait);\n    if (callNow) func.apply(context, args);\n\n    function later() {\n      timeout = null;\n      if (!immediate) func.apply(context, args);\n    }\n  };\n}\n\n// https://github.com/jquery/sizzle/blob/3136f48b90e3edc84cbaaa6f6f7734ef03775a07/sizzle.js#L708\nvar contains = function() {\n  if (!global.document) {\n    return true;\n  }\n  return global.document.documentElement.compareDocumentPosition ?\n    function (a, b) {\n      return !!(a.compareDocumentPosition(b) & 16);\n    } :\n    global.document.documentElement.contains ?\n      function (a, b) {\n        return a !== b && ( a.contains ? a.contains(b) : false );\n      } :\n      function (a, b) {\n        while (b = b.parentNode) {\n          if (b === a) {\n            return true;\n          }\n        }\n        return false;\n      };\n}\n\nfunction createInViewport(container, debounceValue, failsafe) {\n  var watches = createWatches();\n\n  var scrollContainer = container === global.document.body ? global : container;\n  var debouncedCheck = debounce(watches.checkAll(watchInViewport), debounceValue);\n\n  addEvent(scrollContainer, 'scroll', debouncedCheck);\n\n  if (scrollContainer === global) {\n    addEvent(global, 'resize', debouncedCheck);\n  }\n\n  if (supportsMutationObserver) {\n    observeDOM(watches, container, debouncedCheck);\n  }\n\n  // failsafe check, every X we check for visible images\n  // usecase: a hidden parent containing eleements\n  // when the parent becomes visible, we have no event that the children\n  // became visible\n  if (failsafe > 0) {\n    setInterval(debouncedCheck, failsafe);\n  }\n\n  function isInViewport(elt, offset, cb) {\n    if (!cb) {\n      return isVisible(elt, offset);\n    }\n\n    var remote = createRemote(elt, offset, cb);\n    remote.watch();\n    return remote;\n  }\n\n  function createRemote(elt, offset, cb) {\n    function watch() {\n      watches.add(elt, offset, cb);\n    }\n\n    function dispose() {\n      watches.remove(elt);\n    }\n\n    return {\n      watch: watch,\n      dispose: dispose\n    };\n  }\n\n  function watchInViewport(elt, offset, cb) {\n    if (isVisible(elt, offset)) {\n      watches.remove(elt);\n      cb(elt);\n    }\n  }\n\n  function isVisible(elt, offset) {\n    if (!elt) {\n      return false;\n    }\n\n    if (!contains(global.document.documentElement, elt) || !contains(global.document.documentElement, container)) {\n      return false;\n    }\n\n    // Check if the element is visible\n    // https://github.com/jquery/jquery/blob/740e190223d19a114d5373758127285d14d6b71e/src/css/hiddenVisibleSelectors.js\n    if (!elt.offsetWidth || !elt.offsetHeight) {\n      return false;\n    }\n\n    var eltRect = elt.getBoundingClientRect();\n    var viewport = {};\n\n    if (container === global.document.body) {\n      viewport = {\n        top: -offset,\n        left: -offset,\n        right: global.document.documentElement.clientWidth + offset,\n        bottom: global.document.documentElement.clientHeight + offset\n      };\n    } else {\n      var containerRect = container.getBoundingClientRect();\n      viewport = {\n        top: containerRect.top - offset,\n        left: containerRect.left - offset,\n        right: containerRect.right + offset,\n        bottom: containerRect.bottom + offset\n      };\n    }\n\n    // The element must overlap with the visible part of the viewport\n    var visible =\n      (\n        eltRect.right >= viewport.left &&\n        eltRect.left <= viewport.right &&\n        eltRect.bottom >= viewport.top &&\n        eltRect.top <= viewport.bottom\n      );\n\n    return visible;\n  }\n\n  return {\n    container: container,\n    isInViewport: isInViewport,\n    _debounce: debounceValue,\n    _failsafe: failsafe\n  };\n}\n\nfunction createWatches() {\n  var watches = [];\n\n  function add(elt, offset, cb) {\n    if (!isWatched(elt)) {\n      watches.push([elt, offset, cb]);\n    }\n  }\n\n  function remove(elt) {\n    var pos = indexOf(elt);\n    if (pos !== -1) {\n      watches.splice(pos, 1);\n    }\n  }\n\n  function indexOf(elt) {\n    for (var i = watches.length - 1; i >= 0; i--) {\n      if (watches[i][0] === elt) {\n        return i;\n      }\n    }\n    return -1;\n  }\n\n  function isWatched(elt) {\n    return indexOf(elt) !== -1;\n  }\n\n  function checkAll(cb) {\n    return function () {\n      for (var i = watches.length - 1; i >= 0; i--) {\n        cb.apply(this, watches[i]);\n      }\n    };\n  }\n\n  return {\n    add: add,\n    remove: remove,\n    isWatched: isWatched,\n    checkAll: checkAll\n  };\n}\n\nfunction observeDOM(watches, container, cb) {\n  var observer = new MutationObserver(watch);\n  var filter = Array.prototype.filter;\n  var concat = Array.prototype.concat;\n\n  observer.observe(container, {\n    childList: true,\n    subtree: true,\n    // changes like style/width/height/display will be catched\n    attributes: true\n  });\n\n  function watch(mutations) {\n    // some new DOM nodes where previously watched\n    // we should check their positions\n    if (mutations.some(knownNodes) === true) {\n      setTimeout(cb, 0);\n    }\n  }\n\n  function knownNodes(mutation) {\n    var nodes = concat.call([],\n      Array.prototype.slice.call(mutation.addedNodes),\n      mutation.target\n    );\n    return filter.call(nodes, watches.isWatched).length > 0;\n  }\n}\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/_in-viewport@3.6.0@in-viewport/in-viewport.js\n// module id = 23\n// module chunks = 7 8 9","/**\n * Created by dfzq on 2017/8/14.\n */\nconst inViewport = require('in-viewport')\nexport default inViewport\n\n\n// WEBPACK FOOTER //\n// ./src/inViewPort/index.js","/**\n * 图片懒加载\n * Created by dfzq on 2017/8/14.\n */\nimport inViewport from '../../inViewPort'\n\nconst LazyLoad = function ({ container = '.page-group', offset = 333, src = 'data-src' }) {\n    return {\n        actions: {\n            lazyLoad: {\n                refresh: _ => {\n                    // 查看浏览器是否支持MutationObserver特性\n                    let supportsMutationObserver = typeof global.MutationObserver === 'function'\n\n                    let $pageContent = $(container);\n                    // 获取容器内所有的图片集合\n                    let items = $pageContent.find('img')\n\n                    // 占位图片 1px 透明图\n                    var placeholderSrc = 'data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==';\n\n                    if (items && items.length > 0){\n                        $.each(items, function (i, $img) {\n                            if ($img){\n                                let $$img = $($img)\n\n                                // 如果当前img已经定义了src则不执行懒加载\n                                if (!$$img.attr('src')){\n\n                                    // 添加默认占位图片（解决viewport针对没有高度的元素不执行回调的bug，因此默认追加一张1px的透明图片）\n                                    $$img.attr('src', placeholderSrc)\n                                    // 添加默认占位样式\n                                    $$img.addClass('lazyload-load')\n\n                                    // 支持MutationObserver特性\n                                    if (supportsMutationObserver) {\n                                        inViewport($img, { offset: offset }, function (elt) {\n                                            // 获取真实图片地址\n                                            let realSrc = $(elt).attr(src)\n                                            // 获取是否已经执行过懒加载状态\n                                            let isLazyFlag = $(elt).attr('lazy')\n\n                                            if (realSrc && !isLazyFlag) {\n                                                $(elt).attr('src', realSrc)\n                                                $(elt)[0].onerror = function (e) {\n                                                    // 添加图片加载失败刷新的样式\n                                                    $(this).attr('src', 'data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==')\n                                                    $(this).addClass('lazyload-loaderror')\n\n                                                    // 点击重新加载图片\n                                                    $(this).on('click', function () {\n                                                        if ($(this).hasClass('lazyload-loaderror')) {\n                                                            $(this).removeClass('lazyload-loaderror')\n                                                                .addClass('lazyload-load')\n                                                                .attr('src', realSrc)\n                                                        }\n                                                    })\n                                                }\n                                                // 已经懒加载则置为1\n                                                $(elt).attr('lazy', '1')\n\n                                                console.log('[LazyImage CallBack]:' + realSrc)\n                                            }\n                                        })\n                                    }\n                                    // 不支持MutationObserver特性\n                                    else {\n                                        let realSrc = $$img.attr(src)\n                                        if (realSrc) {\n                                            $$img.attr('src', realSrc)\n                                            console.log('[No LazyImage CallBack]:' + realSrc)\n                                        }\n                                    }\n\n                                }\n\n                            }\n                        })\n                    }\n                }\n            }\n        },\n        hooks: {\n            onPageDidAppear: (e, pageId, $page, actions, model)=>{\n                actions.lazyLoad.refresh()\n            },\n        },\n    }\n}\n\nexport {\n    LazyLoad,\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/plugins/lazyLoad/index.js"],"sourceRoot":""}